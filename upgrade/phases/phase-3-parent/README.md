# Phase 3: Parental Control & Monitoring
## ÙØ§Ø² 3: Ú©Ù†ØªØ±Ù„ ÙˆØ§Ù„Ø¯ÛŒÙ† Ùˆ Ù†Ø¸Ø§Ø±Øª (Agent Parent)

**Ù…Ø¯Øª Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ**: 2 Ù‡ÙØªÙ‡  
**Agent Ù…Ø³Ø¦ÙˆÙ„**: Parent Agent  
**ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ**: Phase 1 Base + Phase 2 Core

## Ø§Ù‡Ø¯Ø§Ù ÙØ§Ø²

### Ù‡Ø¯Ù Ø§ØµÙ„ÛŒ
Ø§ÛŒØ¬Ø§Ø¯ Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ú©Ù†ØªØ±Ù„ ÙˆØ§Ù„Ø¯ÛŒÙ† Ùˆ Ù†Ø¸Ø§Ø±Øª Ø¨Ø± ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ ÙØ±Ø²Ù†Ø¯Ø§Ù†

### Ø§Ù‡Ø¯Ø§Ù ÙØ±Ø¹ÛŒ
1. Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ÙˆØ§Ù„Ø¯ÛŒÙ†
2. Ø³ÛŒØ³ØªÙ… Ú¯Ø²Ø§Ø±Ø´â€ŒØ¯Ù‡ÛŒ
3. Ú©Ù†ØªØ±Ù„ Ø²Ù…Ø§Ù† Ùˆ Ù…Ø­ØªÙˆØ§
4. Ø§Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ§Ù„Ø¯ÛŒÙ†
5. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÛŒÙ…Ù†ÛŒ

## ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯

### 1. Parent Dashboard ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦
- **Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯**: Ø¢Ù…Ø§Ø± Ù‡ÙØªÚ¯ÛŒ/Ù…Ø§Ù‡Ø§Ù†Ù‡
- **Ù¾ÛŒØ´Ø±ÙØª ØªØ­ØµÛŒÙ„ÛŒ**: Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ Ùˆ ØªØ±Ù†Ø¯Ù‡Ø§
- **ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±**: timeline Ú©Ø§Ù…Ù„
- **Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù…Ù‡Ù…**: Ù†Ù‚Ø§Ø· Ù†Ú¯Ø±Ø§Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡

### 2. Time Management â°
- **Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø²Ù…Ø§Ù†ÛŒ**: Ø³Ø§Ø¹Ø§Øª Ù…Ø¬Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡
- **Ú©Ù†ØªØ±Ù„ Ø±ÙˆØ²Ø§Ù†Ù‡**: Ø­Ø¯Ø§Ú©Ø«Ø± Ø²Ù…Ø§Ù† Ø¯Ø± Ø±ÙˆØ²
- **Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ**: ØªÙ†Ø¸ÛŒÙ… Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø·Ø§Ù„Ø¹Ù‡
- **Ø§Ø³ØªØ±Ø§Ø­Øª Ø§Ø¬Ø¨Ø§Ø±ÛŒ**: ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø¬Ù„Ø³Ø§Øª

### 3. Content Control ğŸ›¡ï¸
- **ÙÛŒÙ„ØªØ± Ù…Ø­ØªÙˆØ§**: Ø³Ø·ÙˆØ­ Ù…Ø®ØªÙ„Ù ÙÛŒÙ„ØªØ±ÛŒÙ†Ú¯
- **Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ù…Ø¬Ø§Ø²**: Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±ÙˆØ³ Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³
- **Ú©Ù†ØªØ±Ù„ AI**: Ù†Ø¸Ø§Ø±Øª Ø¨Ø± Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
- **Ø¨Ù„Ø§Ú© Ù„ÛŒØ³Øª**: Ú©Ù„Ù…Ø§Øª Ùˆ Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ù…Ù…Ù†ÙˆØ¹

### 4. Reporting System ğŸ“Š
- **Ú¯Ø²Ø§Ø±Ø´ Ù‡ÙØªÚ¯ÛŒ**: Ø§ÛŒÙ…ÛŒÙ„/SMS Ø®ÙˆØ¯Ú©Ø§Ø±
- **Ø¢Ù…Ø§Ø± ØªÙØµÛŒÙ„ÛŒ**: Ø¹Ù…Ù‚ Ø¹Ù…Ù„Ú©Ø±Ø¯
- **Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†**: Ø¨Ù†Ú†Ù…Ø§Ø±Ú© Ú©Ù„Ø§Ø³ÛŒ
- **Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø¨Ù‡Ø¨ÙˆØ¯**: Ø±Ø§Ù‡Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒ

## Models Ø¬Ø¯ÛŒØ¯

### Parent Profile
```python
# educational/models.py (Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯)
class ParentProfile(models.Model):
    """Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÙˆØ§Ù„Ø¯ÛŒÙ†"""
    RELATIONSHIP_CHOICES = [
        ('father', 'Ù¾Ø¯Ø±'),
        ('mother', 'Ù…Ø§Ø¯Ø±'),
        ('guardian', 'Ø³Ø±Ù¾Ø±Ø³Øª'),
        ('grandparent', 'Ù¾Ø¯Ø±Ø¨Ø²Ø±Ú¯/Ù…Ø§Ø¯Ø±Ø¨Ø²Ø±Ú¯'),
        ('other', 'Ø³Ø§ÛŒØ±'),
    ]
    
    user = models.OneToOneField(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name='parent_profile'
    )
    
    # Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ
    relationship = models.CharField(max_length=20, choices=RELATIONSHIP_CHOICES)
    children = models.ManyToManyField(
        StudentProfile,
        related_name='parents',
        verbose_name='ÙØ±Ø²Ù†Ø¯Ø§Ù†'
    )
    
    # ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø¹Ù„Ø§Ù†Ø§Øª
    email_notifications = models.BooleanField(default=True)
    sms_notifications = models.BooleanField(default=True)
    push_notifications = models.BooleanField(default=True)
    weekly_report = models.BooleanField(default=True)
    emergency_alerts = models.BooleanField(default=True)
    
    # ØªØ±Ø¬ÛŒØ­Ø§Øª Ú¯Ø²Ø§Ø±Ø´â€ŒØ¯Ù‡ÛŒ
    report_frequency = models.CharField(
        max_length=20,
        choices=[('daily', 'Ø±ÙˆØ²Ø§Ù†Ù‡'), ('weekly', 'Ù‡ÙØªÚ¯ÛŒ'), ('monthly', 'Ù…Ø§Ù‡Ø§Ù†Ù‡')],
        default='weekly'
    )
    report_time = models.TimeField(default='20:00')  # Ø³Ø§Ø¹Øª Ø§Ø±Ø³Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´
    
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        verbose_name = 'Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÙˆØ§Ù„Ø¯ÛŒÙ†'
        verbose_name_plural = 'Ù¾Ø±ÙˆÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù„Ø¯ÛŒÙ†'
    
    def __str__(self):
        return f"{self.user.get_full_name()} ({self.get_relationship_display()})"

class ParentalControl(models.Model):
    """ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù†ØªØ±Ù„ ÙˆØ§Ù„Ø¯ÛŒÙ†"""
    student = models.OneToOneField(
        StudentProfile,
        on_delete=models.CASCADE,
        related_name='parental_control'
    )
    parent = models.ForeignKey(ParentProfile, on_delete=models.CASCADE)
    
    # Ú©Ù†ØªØ±Ù„ Ø²Ù…Ø§Ù†
    daily_time_limit = models.PositiveIntegerField(
        default=120,  # 2 Ø³Ø§Ø¹Øª
        help_text="Ø­Ø¯Ø§Ú©Ø«Ø± Ø²Ù…Ø§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡ (Ø¯Ù‚ÛŒÙ‚Ù‡)"
    )
    allowed_start_time = models.TimeField(default='07:00')
    allowed_end_time = models.TimeField(default='21:00')
    weekend_time_limit = models.PositiveIntegerField(default=180)  # 3 Ø³Ø§Ø¹Øª
    
    # Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø¬Ø§Ø² (0=Ø¯ÙˆØ´Ù†Ø¨Ù‡ØŒ 6=ÛŒÚ©Ø´Ù†Ø¨Ù‡)
    allowed_weekdays = models.JSONField(default=lambda: [0,1,2,3,4,5,6])
    
    # Ú©Ù†ØªØ±Ù„ Ù…Ø­ØªÙˆØ§
    content_filter_level = models.PositiveSmallIntegerField(
        default=3,
        validators=[MinValueValidator(1), MaxValueValidator(5)],
        help_text="1=Ø¢Ø²Ø§Ø¯ØŒ 5=Ø®ÛŒÙ„ÛŒ Ø³Ø®Øª"
    )
    allowed_subjects = models.ManyToManyField(Subject, blank=True)
    blocked_keywords = models.JSONField(default=list)
    
    # Ú©Ù†ØªØ±Ù„ AI
    ai_supervision = models.BooleanField(default=True, help_text="Ù†Ø¸Ø§Ø±Øª Ø¨Ø± Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ AI")
    require_parent_approval = models.BooleanField(
        default=False, 
        help_text="ØªØ§ÛŒÛŒØ¯ ÙˆØ§Ù„Ø¯ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ø®Ø§Øµ"
    )
    
    # ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡Ø´Ø¯Ø§Ø±
    homework_deadline_alert = models.PositiveIntegerField(
        default=24,
        help_text="Ù‡Ø´Ø¯Ø§Ø± Ù‚Ø¨Ù„ Ø§Ø² Ù…ÙˆØ¹Ø¯ ØªÚ©Ù„ÛŒÙ (Ø³Ø§Ø¹Øª)"
    )
    low_performance_alert = models.BooleanField(default=True)
    excessive_usage_alert = models.BooleanField(default=True)
    
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        verbose_name = 'Ú©Ù†ØªØ±Ù„ ÙˆØ§Ù„Ø¯ÛŒÙ†'
        verbose_name_plural = 'Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù„Ø¯ÛŒÙ†'

class ParentNotification(models.Model):
    """Ø§Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ§Ù„Ø¯ÛŒÙ†"""
    NOTIFICATION_TYPES = [
        ('homework_completed', 'ØªÚ©Ù„ÛŒÙ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯'),
        ('homework_overdue', 'ØªÚ©Ù„ÛŒÙ Ø¹Ù‚Ø¨â€ŒØ§ÙØªØ§Ø¯Ù‡'),
        ('achievement_earned', 'Ø¯Ø³ØªØ§ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯'),
        ('low_performance', 'Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù¾Ø§ÛŒÛŒÙ†'),
        ('excessive_usage', 'Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯'),
        ('weekly_report', 'Ú¯Ø²Ø§Ø±Ø´ Ù‡ÙØªÚ¯ÛŒ'),
        ('system_alert', 'Ù‡Ø´Ø¯Ø§Ø± Ø³ÛŒØ³ØªÙ…'),
    ]
    
    PRIORITY_LEVELS = [
        ('low', 'Ú©Ù…'),
        ('medium', 'Ù…ØªÙˆØ³Ø·'),
        ('high', 'Ø¨Ø§Ù„Ø§'),
        ('urgent', 'ÙÙˆØ±ÛŒ'),
    ]
    
    parent = models.ForeignKey(ParentProfile, on_delete=models.CASCADE)
    student = models.ForeignKey(StudentProfile, on_delete=models.CASCADE)
    
    notification_type = models.CharField(max_length=30, choices=NOTIFICATION_TYPES)
    priority = models.CharField(max_length=10, choices=PRIORITY_LEVELS, default='medium')
    
    title = models.CharField(max_length=200)
    message = models.TextField()
    data = models.JSONField(default=dict)  # Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
    
    # ÙˆØ¶Ø¹ÛŒØª Ø§Ø±Ø³Ø§Ù„
    is_sent = models.BooleanField(default=False)
    sent_at = models.DateTimeField(null=True, blank=True)
    is_read = models.BooleanField(default=False)
    read_at = models.DateTimeField(null=True, blank=True)
    
    # Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„
    sent_via_email = models.BooleanField(default=False)
    sent_via_sms = models.BooleanField(default=False)
    sent_via_push = models.BooleanField(default=False)
    
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        verbose_name = 'Ø§Ø¹Ù„Ø§Ù† ÙˆØ§Ù„Ø¯ÛŒÙ†'
        verbose_name_plural = 'Ø§Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ§Ù„Ø¯ÛŒÙ†'
        ordering = ['-created_at']

class UsageSession(models.Model):
    """Ø¬Ù„Ø³Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø³ÛŒØ³ØªÙ…"""
    student = models.ForeignKey(StudentProfile, on_delete=models.CASCADE)
    
    start_time = models.DateTimeField(auto_now_add=True)
    end_time = models.DateTimeField(null=True, blank=True)
    duration_minutes = models.PositiveIntegerField(default=0)
    
    # ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¬Ù„Ø³Ù‡
    homeworks_worked = models.PositiveIntegerField(default=0)
    questions_asked = models.PositiveIntegerField(default=0)
    messages_sent = models.PositiveIntegerField(default=0)
    
    # Ø¯Ø³ØªÚ¯Ø§Ù‡ Ùˆ Ù…Ú©Ø§Ù†
    device_type = models.CharField(max_length=20, blank=True)  # mobile/tablet/desktop
    ip_address = models.GenericIPAddressField(null=True, blank=True)
    user_agent = models.TextField(blank=True)
    
    class Meta:
        verbose_name = 'Ø¬Ù„Ø³Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡'
        verbose_name_plural = 'Ø¬Ù„Ø³Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡'
```

## API Views

### Parent Dashboard API
```python
# educational/views.py (Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯)
class ParentViewSet(viewsets.ModelViewSet):
    """API Ø¨Ø±Ø§ÛŒ ÙˆØ§Ù„Ø¯ÛŒÙ†"""
    permission_classes = [permissions.IsAuthenticated]
    
    def get_queryset(self):
        return ParentProfile.objects.filter(user=self.request.user)
    
    @action(detail=True, methods=['get'])
    def dashboard(self, request, pk=None):
        """Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ÙˆØ§Ù„Ø¯ÛŒÙ†"""
        parent = self.get_object()
        children_data = []
        
        for child in parent.children.all():
            # Ø¢Ù…Ø§Ø± Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ
            week_start = timezone.now().date() - timedelta(days=7)
            week_homeworks = child.homeworks.filter(
                assigned_date__date__gte=week_start
            )
            
            # ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù‡ÙØªÙ‡
            week_activities = child.daily_activities.filter(
                date__gte=week_start
            )
            
            total_study_time = sum(a.study_minutes for a in week_activities)
            completed_homeworks = week_homeworks.filter(status='completed').count()
            total_homeworks = week_homeworks.count()
            
            # Ù†Ù‚Ø§Ø· Ù‚ÙˆØª Ùˆ Ø¶Ø¹Ù
            analyzer = PerformanceAnalyzer(child)
            weak_areas = analyzer.identify_weak_areas()
            
            children_data.append({
                'child': StudentProfileSerializer(child).data,
                'weekly_stats': {
                    'study_minutes': total_study_time,
                    'homeworks_completed': completed_homeworks,
                    'homeworks_total': total_homeworks,
                    'completion_rate': round(
                        (completed_homeworks / total_homeworks * 100) if total_homeworks > 0 else 0, 1
                    ),
                    'average_score': week_homeworks.filter(
                        status='completed', score__isnull=False
                    ).aggregate(avg=models.Avg('score'))['avg'] or 0
                },
                'concerns': weak_areas[:2],  # Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ Ø¶Ø¹Ù Ø§ØµÙ„ÛŒ
                'achievements_this_week': child.studentachievement_set.filter(
                    earned_at__gte=timezone.now() - timedelta(days=7)
                ).count()
            })
        
        return Response({
            'parent': ParentProfileSerializer(parent).data,
            'children': children_data,
            'summary': {
                'total_children': len(children_data),
                'active_children': len([c for c in children_data if c['weekly_stats']['study_minutes'] > 0]),
                'total_study_hours': sum(c['weekly_stats']['study_minutes'] for c in children_data) / 60,
                'average_completion_rate': sum(c['weekly_stats']['completion_rate'] for c in children_data) / len(children_data) if children_data else 0
            }
        })
    
    @action(detail=True, methods=['get'])
    def detailed_report(self, request, pk=None):
        """Ú¯Ø²Ø§Ø±Ø´ ØªÙØµÛŒÙ„ÛŒ ÙØ±Ø²Ù†Ø¯ Ù…Ø´Ø®Øµ"""
        parent = self.get_object()
        child_id = request.query_params.get('child_id')
        
        if not child_id:
            return Response(
                {'error': 'child_id Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª'},
                status=status.HTTP_400_BAD_REQUEST
            )
        
        try:
            child = parent.children.get(id=child_id)
        except StudentProfile.DoesNotExist:
            return Response(
                {'error': 'ÙØ±Ø²Ù†Ø¯ ÛŒØ§ÙØª Ù†Ø´Ø¯'},
                status=status.HTTP_404_NOT_FOUND
            )
        
        # Ú¯Ø²Ø§Ø±Ø´ 30 Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡
        days = int(request.query_params.get('days', 30))
        cutoff_date = timezone.now().date() - timedelta(days=days)
        
        # ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡
        daily_activities = child.daily_activities.filter(
            date__gte=cutoff_date
        ).order_by('date')
        
        # ØªÚ©Ø§Ù„ÛŒÙ
        homeworks = child.homeworks.filter(
            assigned_date__date__gte=cutoff_date
        ).select_related('subject')
        
        # Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
        total_study_minutes = sum(a.study_minutes for a in daily_activities)
        completed_homeworks = homeworks.filter(status='completed').count()
        average_score = homeworks.filter(
            status='completed', score__isnull=False
        ).aggregate(avg=models.Avg('score'))['avg'] or 0
        
        # ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯
        analyzer = PerformanceAnalyzer(child)
        subject_performance = analyzer.get_subject_performance(days)
        study_plan = analyzer.generate_study_plan()
        
        return Response({
            'child': StudentProfileSerializer(child).data,
            'period': {
                'start_date': cutoff_date,
                'end_date': timezone.now().date(),
                'days': days
            },
            'summary': {
                'total_study_minutes': total_study_minutes,
                'average_daily_minutes': round(total_study_minutes / days, 1),
                'completed_homeworks': completed_homeworks,
                'total_homeworks': homeworks.count(),
                'completion_rate': round((completed_homeworks / homeworks.count() * 100) if homeworks.count() > 0 else 0, 1),
                'average_score': round(average_score, 1),
                'current_streak': child.study_streak
            },
            'daily_activities': DailyActivitySerializer(daily_activities, many=True).data,
            'subject_performance': subject_performance,
            'recommended_study_plan': study_plan,
            'concerns': analyzer.identify_weak_areas()
        })
    
    @action(detail=True, methods=['post'])
    def update_controls(self, request, pk=None):
        """Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù†ØªØ±Ù„"""
        parent = self.get_object()
        child_id = request.data.get('child_id')
        
        try:
            child = parent.children.get(id=child_id)
        except StudentProfile.DoesNotExist:
            return Response(
                {'error': 'ÙØ±Ø²Ù†Ø¯ ÛŒØ§ÙØª Ù†Ø´Ø¯'},
                status=status.HTTP_404_NOT_FOUND
            )
        
        # Ø¯Ø±ÛŒØ§ÙØª ÛŒØ§ Ø§ÛŒØ¬Ø§Ø¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù†ØªØ±Ù„
        control, created = ParentalControl.objects.get_or_create(
            student=child,
            defaults={'parent': parent}
        )
        
        # Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        serializer = ParentalControlSerializer(control, data=request.data, partial=True)
        if serializer.is_valid():
            serializer.save()
            
            # Ø«Ø¨Øª ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± Ù„Ø§Ú¯
            ParentActionLog.objects.create(
                parent=parent,
                student=child,
                action_type='control_update',
                description=f"ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù†ØªØ±Ù„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯",
                data=request.data
            )
            
            return Response({
                'message': 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯',
                'controls': serializer.data
            })
        else:
            return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

class ParentActionLog(models.Model):
    """Ù„Ø§Ú¯ Ø¹Ù…Ù„ÛŒØ§Øª ÙˆØ§Ù„Ø¯ÛŒÙ†"""
    parent = models.ForeignKey(ParentProfile, on_delete=models.CASCADE)
    student = models.ForeignKey(StudentProfile, on_delete=models.CASCADE)
    
    action_type = models.CharField(max_length=50)
    description = models.TextField()
    data = models.JSONField(default=dict)
    ip_address = models.GenericIPAddressField(null=True, blank=True)
    
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        verbose_name = 'Ù„Ø§Ú¯ Ø¹Ù…Ù„ÛŒØ§Øª ÙˆØ§Ù„Ø¯ÛŒÙ†'
        verbose_name_plural = 'Ù„Ø§Ú¯ Ø¹Ù…Ù„ÛŒØ§Øª ÙˆØ§Ù„Ø¯ÛŒÙ†'
```

## Monitoring Services

### Usage Monitor
```python
# educational/monitoring.py
class UsageMonitor:
    """Ù…Ø§Ù†ÛŒØªÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø³ÛŒØ³ØªÙ…"""
    
    @staticmethod
    def start_session(student_profile, request):
        """Ø´Ø±ÙˆØ¹ Ø¬Ù„Ø³Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡"""
        session = UsageSession.objects.create(
            student=student_profile,
            device_type=UsageMonitor._detect_device(request),
            ip_address=UsageMonitor._get_client_ip(request),
            user_agent=request.META.get('HTTP_USER_AGENT', '')
        )
        
        # Ø°Ø®ÛŒØ±Ù‡ session ID Ø¯Ø± cache
        cache.set(f"session:{student_profile.id}", session.id, timeout=3600)
        
        return session
    
    @staticmethod
    def end_session(student_profile):
        """Ù¾Ø§ÛŒØ§Ù† Ø¬Ù„Ø³Ù‡"""
        session_id = cache.get(f"session:{student_profile.id}")
        if session_id:
            try:
                session = UsageSession.objects.get(id=session_id)
                session.end_time = timezone.now()
                session.duration_minutes = (
                    session.end_time - session.start_time
                ).total_seconds() / 60
                session.save()
                
                # Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ
                UsageMonitor._check_time_limits(student_profile, session)
                
            except UsageSession.DoesNotExist:
                pass
    
    @staticmethod
    def _check_time_limits(student_profile, session):
        """Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ"""
        try:
            control = student_profile.parental_control
        except ParentalControl.DoesNotExist:
            return
        
        # Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ²
        today = timezone.now().date()
        today_sessions = UsageSession.objects.filter(
            student=student_profile,
            start_time__date=today
        )
        
        total_minutes = sum(s.duration_minutes for s in today_sessions if s.duration_minutes)
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡
        is_weekend = today.weekday() >= 5  # Ø´Ù†Ø¨Ù‡/ÛŒÚ©Ø´Ù†Ø¨Ù‡
        limit = control.weekend_time_limit if is_weekend else control.daily_time_limit
        
        if total_minutes >= limit:
            # Ø§Ø±Ø³Ø§Ù„ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ù‡ ÙˆØ§Ù„Ø¯ÛŒÙ†
            NotificationService.send_parent_alert(
                student_profile,
                'excessive_usage',
                f"ÙØ±Ø²Ù†Ø¯ØªØ§Ù† Ø§Ù…Ø±ÙˆØ² {total_minutes} Ø¯Ù‚ÛŒÙ‚Ù‡ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯Ù‡ (Ø­Ø¯ Ù…Ø¬Ø§Ø²: {limit} Ø¯Ù‚ÛŒÙ‚Ù‡)"
            )
    
    @staticmethod
    def _detect_device(request):
        """ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ Ø¯Ø³ØªÚ¯Ø§Ù‡"""
        user_agent = request.META.get('HTTP_USER_AGENT', '').lower()
        
        if 'mobile' in user_agent or 'android' in user_agent or 'iphone' in user_agent:
            return 'mobile'
        elif 'tablet' in user_agent or 'ipad' in user_agent:
            return 'tablet'
        else:
            return 'desktop'
    
    @staticmethod
    def _get_client_ip(request):
        """Ø¯Ø±ÛŒØ§ÙØª IP Ú©Ù„Ø§ÛŒÙ†Øª"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip
```

### Notification Service
```python
# educational/notification_service.py
class NotificationService:
    """Ø³Ø±ÙˆÛŒØ³ Ø§Ø¹Ù„Ø§Ù†Ø§Øª"""
    
    @staticmethod
    def send_parent_alert(student_profile, alert_type, message, priority='medium', data=None):
        """Ø§Ø±Ø³Ø§Ù„ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ù‡ ÙˆØ§Ù„Ø¯ÛŒÙ†"""
        parents = student_profile.parents.all()
        
        for parent in parents:
            notification = ParentNotification.objects.create(
                parent=parent,
                student=student_profile,
                notification_type=alert_type,
                priority=priority,
                title=NotificationService._get_alert_title(alert_type),
                message=message,
                data=data or {}
            )
            
            # Ø§Ø±Ø³Ø§Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆØ§Ù„Ø¯ÛŒÙ†
            NotificationService._send_notification(parent, notification)
    
    @staticmethod
    def _send_notification(parent, notification):
        """Ø§Ø±Ø³Ø§Ù„ Ø§Ø¹Ù„Ø§Ù† Ø§Ø² Ø·Ø±ÛŒÙ‚ Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù"""
        # Push Notification
        if parent.push_notifications:
            # Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ push notification
            notification.sent_via_push = True
        
        # SMS Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ§Ø±Ø¯ ÙÙˆØ±ÛŒ
        if notification.priority == 'urgent' and parent.sms_notifications:
            # Ø§Ø±Ø³Ø§Ù„ SMS
            notification.sent_via_sms = True
        
        # Email Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ ØªÙØµÛŒÙ„ÛŒ
        if parent.email_notifications and notification.notification_type == 'weekly_report':
            # Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„
            notification.sent_via_email = True
        
        notification.is_sent = True
        notification.sent_at = timezone.now()
        notification.save()
    
    @staticmethod
    def _get_alert_title(alert_type):
        """ØªÙˆÙ„ÛŒØ¯ Ø¹Ù†ÙˆØ§Ù† Ù‡Ø´Ø¯Ø§Ø±"""
        titles = {
            'homework_completed': 'âœ… ØªÚ©Ù„ÛŒÙ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯',
            'homework_overdue': 'âš ï¸ ØªÚ©Ù„ÛŒÙ Ø¹Ù‚Ø¨â€ŒØ§ÙØªØ§Ø¯Ù‡',
            'achievement_earned': 'ğŸ† Ø¯Ø³ØªØ§ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯',
            'low_performance': 'ğŸ“‰ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆØ¬Ù‡',
            'excessive_usage': 'â° Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø²ÛŒØ§Ø¯',
            'weekly_report': 'ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ù‡ÙØªÚ¯ÛŒ',
            'system_alert': 'ğŸ”” Ø§Ø¹Ù„Ø§Ù† Ø³ÛŒØ³ØªÙ…',
        }
        return titles.get(alert_type, 'ğŸ”” Ø§Ø¹Ù„Ø§Ù†')
    
    @shared_task
    def send_weekly_reports():
        """Ø§Ø±Ø³Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù‡ÙØªÚ¯ÛŒ"""
        parents = ParentProfile.objects.filter(
            weekly_report=True,
            user__is_active=True
        )
        
        for parent in parents:
            for child in parent.children.all():
                report_data = WeeklyReportGenerator.generate(child)
                
                NotificationService.send_parent_alert(
                    child,
                    'weekly_report',
                    WeeklyReportGenerator.format_message(report_data),
                    priority='low',
                    data=report_data
                )

class WeeklyReportGenerator:
    """ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡ Ú¯Ø²Ø§Ø±Ø´ Ù‡ÙØªÚ¯ÛŒ"""
    
    @staticmethod
    def generate(student_profile):
        """ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´ Ù‡ÙØªÚ¯ÛŒ"""
        week_start = timezone.now().date() - timedelta(days=7)
        
        # ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù‡ÙØªÙ‡
        activities = student_profile.daily_activities.filter(
            date__gte=week_start
        )
        
        # ØªÚ©Ø§Ù„ÛŒÙ Ù‡ÙØªÙ‡
        homeworks = student_profile.homeworks.filter(
            assigned_date__date__gte=week_start
        )
        
        # Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø±
        total_study_time = sum(a.study_minutes for a in activities)
        completed_homeworks = homeworks.filter(status='completed').count()
        average_score = homeworks.filter(
            status='completed', score__isnull=False
        ).aggregate(avg=models.Avg('score'))['avg'] or 0
        
        # Ù†Ù‚Ø§Ø· Ù‚ÙˆØª Ùˆ Ø¶Ø¹Ù
        analyzer = PerformanceAnalyzer(student_profile)
        subject_performance = analyzer.get_subject_performance(7)
        
        best_subject = ""
        worst_subject = ""
        if subject_performance:
            best_subject = max(subject_performance.items(), key=lambda x: x[1]['average_score'])[0]
            worst_subject = min(subject_performance.items(), key=lambda x: x[1]['average_score'])[0]
        
        return {
            'student_name': student_profile.user.get_full_name(),
            'week_start': week_start,
            'week_end': timezone.now().date(),
            'total_study_minutes': total_study_time,
            'study_hours': round(total_study_time / 60, 1),
            'completed_homeworks': completed_homeworks,
            'total_homeworks': homeworks.count(),
            'completion_rate': round((completed_homeworks / homeworks.count() * 100) if homeworks.count() > 0 else 0, 1),
            'average_score': round(average_score, 1),
            'best_subject': best_subject,
            'worst_subject': worst_subject,
            'current_streak': student_profile.study_streak,
            'achievements_earned': student_profile.studentachievement_set.filter(
                earned_at__gte=timezone.now() - timedelta(days=7)
            ).count()
        }
    
    @staticmethod
    def format_message(report_data):
        """ÙØ±Ù…Øª Ù¾ÛŒØ§Ù… Ú¯Ø²Ø§Ø±Ø´"""
        return f"""
ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ù‡ÙØªÚ¯ÛŒ {report_data['student_name']}

ğŸ“š Ù…Ø·Ø§Ù„Ø¹Ù‡: {report_data['study_hours']} Ø³Ø§Ø¹Øª
âœ… ØªÚ©Ø§Ù„ÛŒÙ: {report_data['completed_homeworks']}/{report_data['total_homeworks']} ({report_data['completion_rate']}%)
ğŸ“ˆ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù†Ù…Ø±Ù‡: {report_data['average_score']}
ğŸ”¥ Ø±Ú©ÙˆØ±Ø¯ Ù…ØªÙˆØ§Ù„ÛŒ: {report_data['current_streak']} Ø±ÙˆØ²

ğŸ’ª Ø¨Ù‡ØªØ±ÛŒÙ† Ø¯Ø±Ø³: {report_data['best_subject']}
ğŸ¯ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ†: {report_data['worst_subject']}

ğŸ† Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯: {report_data['achievements_earned']}

Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡ Ø¹Ø²ÛŒØ²Ù…! ğŸŒŸ
        """.strip()
```

## Content Safety System

### AI Content Filter
```python
# educational/safety.py
class ContentSafetyFilter:
    """ÙÛŒÙ„ØªØ± Ø§ÛŒÙ…Ù†ÛŒ Ù…Ø­ØªÙˆØ§"""
    
    # Ú©Ù„Ù…Ø§Øª Ùˆ Ø¹Ø¨Ø§Ø±Ø§Øª Ù…Ù…Ù†ÙˆØ¹
    BLOCKED_KEYWORDS = [
        # Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÛŒØ§Ø²
    ]
    
    # Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø­Ø³Ø§Ø³
    SENSITIVE_TOPICS = [
        'Ø³ÛŒØ§Ø³Øª', 'Ù…Ø°Ù‡Ø¨', 'Ø®Ø´ÙˆÙ†Øª', 'Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨'
    ]
    
    def __init__(self, grade_level):
        self.grade_level = grade_level
        self.filter_level = self._get_filter_level(grade_level)
    
    def _get_filter_level(self, grade_level):
        """ØªØ¹ÛŒÛŒÙ† Ø³Ø·Ø­ ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ù†"""
        if grade_level <= 3:
            return 5  # Ø®ÛŒÙ„ÛŒ Ø³Ø®Øª
        elif grade_level <= 6:
            return 4  # Ø³Ø®Øª
        elif grade_level <= 9:
            return 3  # Ù…ØªÙˆØ³Ø·
        else:
            return 2  # Ù…Ù„Ø§ÛŒÙ…
    
    def filter_ai_response(self, response_text):
        """ÙÛŒÙ„ØªØ± Ù¾Ø§Ø³Ø® AI"""
        # Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹
        for keyword in self.BLOCKED_KEYWORDS:
            if keyword.lower() in response_text.lower():
                return False, f"Ù…Ø­ØªÙˆØ§ Ø´Ø§Ù…Ù„ Ú©Ù„Ù…Ù‡ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³Øª: {keyword}"
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø·Ø­ Ø³Ø®ØªÛŒ Ø²Ø¨Ø§Ù†
        if self._is_too_complex(response_text):
            return False, "Ø²Ø¨Ø§Ù† Ù¾Ø§Ø³Ø® Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø³Ù† Ù…Ù†Ø§Ø³Ø¨ Ù†ÛŒØ³Øª"
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø­Ø³Ø§Ø³
        for topic in self.SENSITIVE_TOPICS:
            if self._contains_sensitive_topic(response_text, topic):
                return False, f"Ù…Ø­ØªÙˆØ§ Ø´Ø§Ù…Ù„ Ù…ÙˆØ¶ÙˆØ¹ Ø­Ø³Ø§Ø³ Ø§Ø³Øª: {topic}"
        
        return True, response_text
    
    def filter_user_input(self, user_message):
        """ÙÛŒÙ„ØªØ± ÙˆØ±ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±"""
        # Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ
        if self._contains_personal_info(user_message):
            return False, "Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ Ø±Ø§ Ø¯Ø± Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø°Ú©Ø± Ù†Ú©Ù†ÛŒØ¯"
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨
        for keyword in self.BLOCKED_KEYWORDS:
            if keyword.lower() in user_message.lower():
                return False, "Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ú©Ù„Ù…Ø§Øª Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯"
        
        return True, user_message
    
    def _is_too_complex(self, text):
        """Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒÚ†ÛŒØ¯Ú¯ÛŒ Ø²Ø¨Ø§Ù†"""
        # Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø§Ø¯Ù‡ Ù¾ÛŒÚ†ÛŒØ¯Ú¯ÛŒ
        words = text.split()
        avg_word_length = sum(len(word) for word in words) / len(words) if words else 0
        
        # Ø­Ø¯ Ø¢Ø³ØªØ§Ù†Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù¾Ø§ÛŒÙ‡
        thresholds = {1: 4, 2: 4, 3: 5, 4: 5, 5: 6, 6: 6, 7: 7, 8: 7, 9: 8, 10: 9, 11: 10, 12: 10}
        threshold = thresholds.get(self.grade_level, 8)
        
        return avg_word_length > threshold
    
    def _contains_sensitive_topic(self, text, topic):
        """Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø­Ø³Ø§Ø³"""
        # Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø§Ø¯Ù‡ - Ø¯Ø± Ø¹Ù…Ù„ Ø¨Ø§ÛŒØ¯ Ù¾ÛŒÚ†ÛŒØ¯Ù‡â€ŒØªØ± Ø¨Ø§Ø´Ø¯
        return topic.lower() in text.lower()
    
    def _contains_personal_info(self, text):
        """Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ"""
        import re
        
        # Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ
        patterns = [
            r'\b09\d{9}\b',  # Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
            r'\b\d{10}\b',   # Ú©Ø¯ Ù…Ù„ÛŒ
            r'\b[\w\.-]+@[\w\.-]+\.\w+\b',  # Ø§ÛŒÙ…ÛŒÙ„
        ]
        
        for pattern in patterns:
            if re.search(pattern, text):
                return True
        
        return False
```

## Middleware Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ

```python
# educational/middleware.py
class ParentalControlMiddleware:
    """Middleware Ú©Ù†ØªØ±Ù„ ÙˆØ§Ù„Ø¯ÛŒÙ†"""
    
    def __init__(self, get_response):
        self.get_response = get_response
    
    def __call__(self, request):
        # Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øª
        if self._should_check_controls(request):
            control_result = self._check_parental_controls(request)
            if not control_result['allowed']:
                return JsonResponse(
                    {'error': control_result['reason']},
                    status=403
                )
        
        response = self.get_response(request)
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
        return response
    
    def _should_check_controls(self, request):
        """ØªØ¹ÛŒÛŒÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ØªØ±Ù„"""
        # ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ APIâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ
        return (
            request.path.startswith('/api/educational/') and
            request.user.is_authenticated and
            hasattr(request.user, 'student_profile')
        )
    
    def _check_parental_controls(self, request):
        """Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù„Ø¯ÛŒÙ†"""
        student = request.user.student_profile
        
        try:
            control = student.parental_control
        except ParentalControl.DoesNotExist:
            return {'allowed': True}
        
        if not control.is_active:
            return {'allowed': True}
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ø²Ù…Ø§Ù† Ù…Ø¬Ø§Ø²
        now = timezone.now()
        current_time = now.time()
        current_day = now.weekday()
        
        if current_day not in control.allowed_weekdays:
            return {
                'allowed': False,
                'reason': 'Ø§Ù…Ø±ÙˆØ² Ø±ÙˆØ² Ù…Ø¬Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†ÛŒØ³Øª'
            }
        
        if not (control.allowed_start_time <= current_time <= control.allowed_end_time):
            return {
                'allowed': False,
                'reason': f'Ø³Ø§Ø¹Øª Ù…Ø¬Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡: {control.allowed_start_time} ØªØ§ {control.allowed_end_time}'
            }
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø²Ù…Ø§Ù† Ø±ÙˆØ²Ø§Ù†Ù‡
        today_usage = self._get_today_usage(student)
        is_weekend = current_day >= 5
        limit = control.weekend_time_limit if is_weekend else control.daily_time_limit
        
        if today_usage >= limit:
            return {
                'allowed': False,
                'reason': f'Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ² ØªÙ…Ø§Ù… Ø´Ø¯Ù‡ ({limit} Ø¯Ù‚ÛŒÙ‚Ù‡)'
            }
        
        return {'allowed': True}
    
    def _get_today_usage(self, student):
        """Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ²"""
        today = timezone.now().date()
        sessions = UsageSession.objects.filter(
            student=student,
            start_time__date=today
        )
        
        return sum(s.duration_minutes for s in sessions if s.duration_minutes)
```

## Celery Tasks

### Scheduled Tasks
```python
# educational/tasks.py
from celery import shared_task
from celery.schedules import crontab
from django_celery_beat.models import PeriodicTask, CrontabSchedule

@shared_task
def check_homework_deadlines():
    """Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¹Ø¯ ØªÚ©Ø§Ù„ÛŒÙ"""
    tomorrow = timezone.now() + timedelta(days=1)
    
    # ØªÚ©Ø§Ù„ÛŒÙ ÙØ±Ø¯Ø§
    upcoming = Homework.objects.filter(
        due_date__date=tomorrow.date(),
        status__in=['pending', 'in_progress']
    ).select_related('student', 'subject')
    
    for homework in upcoming:
        # ÛŒØ§Ø¯Ø¢ÙˆØ± Ø¨Ù‡ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
        SmartReminderService.send_homework_reminder(homework)
        
        # Ø§Ø¹Ù„Ø§Ù† Ø¨Ù‡ ÙˆØ§Ù„Ø¯ÛŒÙ†
        NotificationService.send_parent_alert(
            homework.student,
            'homework_deadline',
            f"Ù…ÙˆØ¹Ø¯ ØªÚ©Ù„ÛŒÙ {homework.title} ÙØ±Ø¯Ø§ Ø§Ø³Øª"
        )

@shared_task
def update_student_levels():
    """Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ø·Ø­ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†"""
    students = StudentProfile.objects.all()
    
    for student in students:
        old_level = student.current_level
        
        # Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø·Ø­ Ø¬Ø¯ÛŒØ¯
        level_up_points = 100  # Ø§Ø² settings
        new_level = (student.total_points // level_up_points) + 1
        
        if new_level > old_level:
            student.current_level = new_level
            student.save()
            
            # Ø§Ø¹Ù„Ø§Ù† Ø§Ø±ØªÙ‚Ø§ Ø³Ø·Ø­
            NotificationService.send_parent_alert(
                student,
                'level_up',
                f"ÙØ±Ø²Ù†Ø¯ØªØ§Ù† Ø¨Ù‡ Ø³Ø·Ø­ {new_level} Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØª!",
                priority='medium'
            )

@shared_task
def generate_daily_challenges():
    """ØªÙˆÙ„ÛŒØ¯ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡"""
    today = timezone.now().date()
    
    # Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú†Ø§Ù„Ø´ Ø§Ù…Ø±ÙˆØ²
    if DailyChallenge.objects.filter(date=today).exists():
        return
    
    # ØªÙˆÙ„ÛŒØ¯ Ú†Ø§Ù„Ø´ Ø¬Ø¯ÛŒØ¯
    challenge_types = [
        {
            'type': 'homework_count',
            'title': 'Ù‚Ù‡Ø±Ù…Ø§Ù† ØªÚ©Ø§Ù„ÛŒÙ',
            'description': 'Ø§Ù…Ø±ÙˆØ² 3 ØªÚ©Ù„ÛŒÙ ØªÚ©Ù…ÛŒÙ„ Ú©Ù†',
            'target': 3,
            'points': 150
        },
        {
            'type': 'study_time',
            'title': 'Ù…Ø·Ø§Ù„Ø¹Ù‡â€ŒÚ¯Ø± Ù¾ÛŒÚ¯ÛŒØ±',
            'description': 'Ø§Ù…Ø±ÙˆØ² 60 Ø¯Ù‚ÛŒÙ‚Ù‡ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ù†',
            'target': 60,
            'points': 100
        }
    ]
    
    import random
    challenge_data = random.choice(challenge_types)
    
    DailyChallenge.objects.create(
        date=today,
        title=challenge_data['title'],
        description=challenge_data['description'],
        challenge_type=challenge_data['type'],
        target_value=challenge_data['target'],
        points_reward=challenge_data['points'],
        grade_levels=list(range(1, 13))  # Ù‡Ù…Ù‡ Ù¾Ø§ÛŒÙ‡â€ŒÙ‡Ø§
    )

# ØªÙ†Ø¸ÛŒÙ… Periodic Tasks
def setup_periodic_tasks():
    """Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ taskâ€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ"""
    
    # Ù‡Ø± Ø±ÙˆØ² Ø³Ø§Ø¹Øª 8 ØµØ¨Ø­ - Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¹Ø¯ ØªÚ©Ø§Ù„ÛŒÙ
    schedule, _ = CrontabSchedule.objects.get_or_create(
        minute=0,
        hour=8,
        day_of_week='*',
        day_of_month='*',
        month_of_year='*',
    )
    
    PeriodicTask.objects.get_or_create(
        crontab=schedule,
        name='Check Homework Deadlines',
        task='educational.tasks.check_homework_deadlines',
    )
    
    # Ù‡Ø± ÛŒÚ©Ø´Ù†Ø¨Ù‡ Ø³Ø§Ø¹Øª 20 - Ú¯Ø²Ø§Ø±Ø´ Ù‡ÙØªÚ¯ÛŒ
    weekly_schedule, _ = CrontabSchedule.objects.get_or_create(
        minute=0,
        hour=20,
        day_of_week=6,  # ÛŒÚ©Ø´Ù†Ø¨Ù‡
        day_of_month='*',
        month_of_year='*',
    )
    
    PeriodicTask.objects.get_or_create(
        crontab=weekly_schedule,
        name='Send Weekly Reports',
        task='educational.notification_service.send_weekly_reports',
    )
```

## Testing ÙØ§Ø² 3

```python
# educational/tests/test_parental_control.py
class ParentalControlTest(APITestCase):
    """ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ ÙˆØ§Ù„Ø¯ÛŒÙ†"""
    
    def setUp(self):
        # Ø§ÛŒØ¬Ø§Ø¯ ÙˆØ§Ù„Ø¯ÛŒÙ†
        self.parent_user = User.objects.create_user(
            username='parent',
            phone_number='09123456789',
            first_name='Ø§Ø­Ù…Ø¯',
            last_name='Ø§Ø­Ù…Ø¯ÛŒ'
        )
        self.parent_profile = ParentProfile.objects.create(
            user=self.parent_user,
            relationship='father'
        )
        
        # Ø§ÛŒØ¬Ø§Ø¯ ÙØ±Ø²Ù†Ø¯
        self.child_user = User.objects.create_user(
            username='child',
            phone_number='09123456788'
        )
        self.child_profile = StudentProfile.objects.create(
            user=self.child_user,
            grade_level=5
        )
        
        # Ø§Ø±ØªØ¨Ø§Ø· ÙˆØ§Ù„Ø¯ÛŒÙ†-ÙØ±Ø²Ù†Ø¯
        self.parent_profile.children.add(self.child_profile)
        
        # Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ØªØ±Ù„
        self.control = ParentalControl.objects.create(
            student=self.child_profile,
            parent=self.parent_profile,
            daily_time_limit=60,  # 1 Ø³Ø§Ø¹Øª
            allowed_start_time='08:00',
            allowed_end_time='20:00'
        )
    
    def test_parent_dashboard(self):
        """ØªØ³Øª Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ÙˆØ§Ù„Ø¯ÛŒÙ†"""
        self.client.force_authenticate(user=self.parent_user)
        
        url = reverse('parent-dashboard', kwargs={'pk': self.parent_profile.id})
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        data = response.json()
        
        self.assertIn('children', data)
        self.assertEqual(len(data['children']), 1)
        self.assertEqual(data['summary']['total_children'], 1)
    
    def test_time_limit_enforcement(self):
        """ØªØ³Øª Ø§Ø¹Ù…Ø§Ù„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø²Ù…Ø§Ù†ÛŒ"""
        # Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯
        UsageSession.objects.create(
            student=self.child_profile,
            duration_minutes=70  # Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² (60 Ø¯Ù‚ÛŒÙ‚Ù‡)
        )
        
        # Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯ Ø§Ø² ÙØ±Ø²Ù†Ø¯
        self.client.force_authenticate(user=self.child_user)
        
        url = reverse('homework-list')
        response = self.client.get(url)
        
        # Ø¨Ø§ÛŒØ¯ Ù…Ø­Ø¯ÙˆØ¯ Ø´ÙˆØ¯ (Ø¯Ø± middleware)
        # Ø§ÛŒÙ† ØªØ³Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ middleware Ø¯Ø§Ø±Ø¯
```

## Deployment Ùˆ Configuration

### Environment Variables
```bash
# .env Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯:
PARENTAL_CONTROL_ENABLED=true
CONTENT_FILTER_LEVEL=3
NOTIFICATION_CHANNELS=push,sms,email
WEEKLY_REPORT_TIME=20:00
EMERGENCY_ALERT_PHONE=+989123456789
```

### Celery Beat Schedule
```python
# config/settings.py Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯:
from celery.schedules import crontab

CELERY_BEAT_SCHEDULE = {
    'check-homework-deadlines': {
        'task': 'educational.tasks.check_homework_deadlines',
        'schedule': crontab(hour=8, minute=0),  # Ù‡Ø± Ø±ÙˆØ² 8 ØµØ¨Ø­
    },
    'send-weekly-reports': {
        'task': 'educational.notification_service.send_weekly_reports',
        'schedule': crontab(hour=20, minute=0, day_of_week=6),  # ÛŒÚ©Ø´Ù†Ø¨Ù‡ 8 Ø´Ø¨
    },
    'update-student-levels': {
        'task': 'educational.tasks.update_student_levels',
        'schedule': crontab(hour=0, minute=30),  # Ù‡Ø± Ø±ÙˆØ² 12:30 Ø´Ø¨
    },
    'generate-daily-challenges': {
        'task': 'educational.tasks.generate_daily_challenges',
        'schedule': crontab(hour=6, minute=0),  # Ù‡Ø± Ø±ÙˆØ² 6 ØµØ¨Ø­
    },
}
```

## Success Metrics

### Parental Engagement
- [ ] Parent Registration Rate > 80%
- [ ] Weekly Report Open Rate > 60%
- [ ] Control Settings Usage > 50%
- [ ] Parent Satisfaction NPS > 70

### Child Safety
- [ ] Content Filter Accuracy > 95%
- [ ] Zero Inappropriate Content Reports
- [ ] Time Limit Compliance > 90%
- [ ] Parent Alert Response Time < 5 minutes

### System Performance
- [ ] Notification Delivery Rate > 98%
- [ ] Real-time Monitoring Accuracy > 95%
- [ ] Dashboard Load Time < 3 seconds
- [ ] Mobile App Responsiveness > 95%

---

**Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…**: Ø§ÛŒÙ† ÙØ§Ø² Ø§Ù…Ù†ÛŒØª Ùˆ Ú©Ù†ØªØ±Ù„ ÙˆØ§Ù„Ø¯ÛŒÙ† Ø±Ø§ ØªØ¶Ù…ÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ø¨Ø±Ø§ÛŒ Ú©Ø³Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª.